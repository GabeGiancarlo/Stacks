<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stacks Database ER Diagram</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            er: {
                fontSize: 18,
                entityPadding: 25,
                fill: '#fffffe',
                stroke: '#2b2c34',
                textColor: '#2b2c34'
            }
        });
    </script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2b2c34;
            margin-top: 0;
            border-bottom: 3px solid #D4AF37;
            padding-bottom: 10px;
        }
        .mermaid {
            display: flex;
            justify-content: center;
            overflow-x: auto;
            padding: 30px 0;
            background: #fafafa;
            border-radius: 4px;
            margin: 20px 0;
            font-size: 16px;
            zoom: 1.2;
        }
        .info {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            border-left: 4px solid #D4AF37;
        }
        .info h2 {
            margin-top: 0;
            color: #2b2c34;
        }
        .info ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .info li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“š Stacks Database ER Diagram</h1>
        
        <div class="mermaid">
erDiagram
    USERS ||--o{ USER_BOOKS : "has"
    USERS ||--o{ SHELVES : "creates"
    USERS ||--o{ REVIEWS : "writes"
    USERS ||--o{ USER_BADGES : "earns"
    USERS ||--o{ READING_SESSIONS : "tracks"
    USERS ||--o{ READING_HISTORY : "has"
    USERS ||--o{ ACTIVITIES : "generates"
    USERS ||--o{ NOTIFICATIONS : "receives"
    
    USERS ||--o{ FRIENDS_USER1 : "friends with (as user1)"
    USERS ||--o{ FRIENDS_USER2 : "friends with (as user2)"
    USERS ||--o{ FRIEND_REQUESTS_REQUESTER : "sends"
    USERS ||--o{ FRIEND_REQUESTS_RECIPIENT : "receives"
    
    BOOKS ||--o{ USER_BOOKS : "included in"
    BOOKS ||--o{ REVIEWS : "reviewed in"
    BOOKS ||--o{ SHELF_BOOKS : "placed on"
    BOOKS ||--o{ BOOK_AUTHORS : "written by"
    BOOKS ||--o{ BOOK_GENRES : "categorized as"
    BOOKS ||--o{ ACTIVITIES : "referenced in"
    
    AUTHORS ||--o{ BOOK_AUTHORS : "writes"
    GENRES ||--o{ BOOK_GENRES : "categorizes"
    
    SHELVES ||--o{ SHELF_BOOKS : "contains"
    
    USER_BOOKS ||--o{ READING_SESSIONS : "has"
    USER_BOOKS ||--o{ ACTIVITIES : "generates"
    
    BADGES ||--o{ USER_BADGES : "earned as"
    BADGES ||--o{ ACTIVITIES : "referenced in"
    
    REVIEWS ||--o{ ACTIVITIES : "generates"
    
    USERS {
        int id PK
        string email UK
        string username UK
        string password_hash
        string display_name
        text bio
        string avatar_url
        json privacy_settings
        int total_books_read
        int total_pages_read
        datetime created_at
        datetime updated_at
        datetime last_login_at
    }
    
    BOOKS {
        int id PK
        string isbn UK
        string title
        string subtitle
        text description
        string cover_image_url
        date publication_date
        string publisher
        int page_count
        string language
        string source_api
        datetime fetched_at
        datetime created_at
        datetime updated_at
    }
    
    AUTHORS {
        int id PK
        string name
        text bio
        string photo_url
        date birth_date
        date death_date
        datetime created_at
        datetime updated_at
    }
    
    GENRES {
        int id PK
        string name UK
        int parent_genre_id FK
        datetime created_at
    }
    
    USER_BOOKS {
        int id PK
        int user_id FK
        int book_id FK
        string reading_status
        int rating
        text notes
        int current_page
        decimal completion_percentage
        date date_added
        date date_started
        date date_finished
        json custom_metadata
        datetime created_at
        datetime updated_at
    }
    
    READING_SESSIONS {
        int id PK
        int user_book_id FK
        date session_date
        int duration_minutes
        int pages_read
        text progress_notes
        string reading_location
        datetime created_at
    }
    
    READING_HISTORY {
        int id PK
        int user_id FK
        date history_date
        int pages_read
        int cumulative_pages_read
        int reading_streak_days
        datetime created_at
        datetime updated_at
    }
    
    SHELVES {
        int id PK
        int user_id FK
        string name
        text description
        string shelf_style
        int display_order
        string privacy_setting
        datetime created_at
        datetime updated_at
    }
    
    SHELF_BOOKS {
        int id PK
        int shelf_id FK
        int book_id FK
        int display_position
        text shelf_notes
        date date_added
        datetime created_at
    }
    
    REVIEWS {
        int id PK
        int user_id FK
        int book_id FK
        text review_content
        int rating
        int helpful_votes
        string status
        string privacy_setting
        datetime created_at
        datetime updated_at
    }
    
    FRIENDS {
        int id PK
        int user1_id FK
        int user2_id FK
        string status
        date date_connected
        datetime last_interaction_at
        datetime created_at
    }
    
    FRIEND_REQUESTS {
        int id PK
        int requester_id FK
        int recipient_id FK
        string status
        datetime created_at
        datetime responded_at
    }
    
    ACTIVITIES {
        int id PK
        int user_id FK
        string activity_type
        int target_book_id FK
        int target_review_id FK
        int target_badge_id FK
        json activity_metadata
        string visibility
        datetime created_at
    }
    
    BADGES {
        int id PK
        string name UK
        text description
        string category
        string tier
        string icon_url
        json unlock_criteria
        int points_value
        datetime created_at
    }
    
    USER_BADGES {
        int id PK
        int user_id FK
        int badge_id FK
        date date_earned
        decimal progress_to_next_tier
        int display_priority
        datetime created_at
    }
    
    BOOK_AUTHORS {
        int id PK
        int book_id FK
        int author_id FK
        string role
        int author_order
        datetime created_at
    }
    
    BOOK_GENRES {
        int id PK
        int book_id FK
        int genre_id FK
        string designation
        datetime created_at
    }
    
    NOTIFICATIONS {
        int id PK
        int recipient_id FK
        string notification_type
        int associated_friend_request_id FK
        int associated_review_id FK
        text notification_content
        boolean is_read
        datetime created_at
        datetime read_at
    }
        </div>
        
        <div class="info">
            <h2>ðŸ“Š Diagram Information</h2>
            <ul>
                <li><strong>Total Entities:</strong> 18</li>
                <li><strong>Core Entities:</strong> users, books, authors, genres</li>
                <li><strong>Relationship Tables:</strong> user_books, shelf_books, book_authors, book_genres, friends</li>
                <li><strong>Social Features:</strong> reviews, friend_requests, activities, notifications</li>
                <li><strong>Achievement System:</strong> badges, user_badges</li>
                <li><strong>Reading Tracking:</strong> reading_sessions, reading_history</li>
            </ul>
            <p><strong>Note:</strong> This diagram shows all relationships and foreign keys. PK = Primary Key, FK = Foreign Key, UK = Unique Key.</p>
        </div>
    </div>
</body>
</html>


